generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Menu {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  slug      String   @unique @db.VarChar(100)
  position  Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  pages     Page[]
}

model Page {
  id           Int                @id @default(autoincrement())
  menuId       Int?
  parentId     Int?
  title        String             @db.VarChar(200)
  slug         String             @db.VarChar(200)
  position     Int
  status       String             @default("draft") @db.VarChar(20)
  seoMeta      Json?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @default(now()) @updatedAt
  menu         Menu?              @relation(fields: [menuId], references: [id])
  parent       Page?              @relation("PageHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children     Page[]             @relation("PageHierarchy")
  directorates PageDirectorates[]
  sections     PageSection[]
}

model PageSection {
  id            Int            @id @default(autoincrement())
  pageId        Int
  title         String        @db.VarChar(200)
  position      Int
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @default(now()) @updatedAt
  contentBlocks ContentBlock[]
  page          Page           @relation(fields: [pageId], references: [id], onDelete: Cascade)
}

model ContentBlock {
  id        Int         @id @default(autoincrement())
  sectionId Int
  blockType String      @db.VarChar(30)
  content   Json
  position  Int
  isVisible Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @default(now()) @updatedAt
  section   PageSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
}

model Designation {
  id           Int           @id @default(autoincrement())
  title        String        @unique @db.VarChar(100)
  priority     Int
  directorates Directorate[]
}

model Department {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(200)
  directorates Directorate[]
}

model Directorate {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(200)
  designationId    Int?
  departmentId     Int?
  photoUrl         String?
  profile          Json?
  isActive         Boolean            @default(true)
  department       Department?        @relation(fields: [departmentId], references: [id])
  designation      Designation?       @relation(fields: [designationId], references: [id])
  pageDirectorates PageDirectorates[]
}

model PageDirectorates {
  pageId        Int
  directorateId Int
  position      Int?
  directorate   Directorate @relation(fields: [directorateId], references: [id], onDelete: Cascade)
  page          Page        @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@id([pageId, directorateId])
}

model Notification {
  id          Int       @id @default(autoincrement())
  title       String    @db.VarChar(300)
  link        String
  category    String?   @db.VarChar(50)
  status      String    @default("open") @db.VarChar(20)
  priority    Int       @default(0)
  startsAt    DateTime?
  endsAt      DateTime?
  isScrolling Boolean   @default(false)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
}

model Media {
  id         Int      @id @default(autoincrement())
  url        String
  type       String?  @db.VarChar(30)
  uploadedBy Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
}

model Admin {
  id           Int    @id @default(autoincrement())
  name         String @db.VarChar(100)
  email        String @unique @db.VarChar(150)
  passwordHash String
}
